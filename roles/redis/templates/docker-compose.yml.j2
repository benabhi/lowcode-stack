# ==============================================================================
# Redis Docker Compose
# Generated by Ansible - DO NOT EDIT MANUALLY
# ==============================================================================

services:
  redis:
    image: {{ redis_image }}:{{ redis_version }}
    container_name: {{ redis_container_name }}
    restart: unless-stopped
{% if redis_requirepass and redis_password %}
    command: >
      redis-server
      --requirepass {{ redis_password }}
      --maxmemory {{ redis_maxmemory }}
      --maxmemory-policy {{ redis_maxmemory_policy }}
      --appendonly {{ redis_appendonly }}
      --appendfsync {{ redis_appendfsync }}
{% else %}
    command: >
      redis-server
      --maxmemory {{ redis_maxmemory }}
      --maxmemory-policy {{ redis_maxmemory_policy }}
      --appendonly {{ redis_appendonly }}
      --appendfsync {{ redis_appendfsync }}
{% endif %}
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli"{% if redis_requirepass and redis_password %}, "-a", "{{ redis_password }}"{% endif %}, "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 10s
    networks:
      - {{ redis_docker_network }}

volumes:
  redis_data:
    driver: local

networks:
  {{ redis_docker_network }}:
    external: true
