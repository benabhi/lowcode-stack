# ==============================================================================
# Role: gitea - Health Check Tasks
# ==============================================================================

---
- name: Wait for gitea to be healthy
  ansible.builtin.uri:
    url: "http://127.0.0.1:{{ gitea_http_port }}/api/v1/version"
    method: GET
    status_code: 200
  register: gitea_health
  until: gitea_health.status == 200
  retries: "{{ gitea_healthcheck_retries }}"
  delay: "{{ gitea_healthcheck_delay }}"
  become: true

- name: Display gitea health status
  ansible.builtin.debug:
    msg: "Gitea is healthy and responding on port {{ gitea_http_port }}"
  when: gitea_health.status == 200
