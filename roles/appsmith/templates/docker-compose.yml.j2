# ==============================================================================
# Appsmith Docker Compose
# Generated by Ansible - DO NOT EDIT MANUALLY
# ==============================================================================

services:
  appsmith:
    image: {{ appsmith_image }}:{{ appsmith_version }}
    container_name: {{ appsmith_container_name }}
    restart: unless-stopped
    ports:
      - "{{ appsmith_port }}:{{ appsmith_internal_port }}"
    volumes:
      - appsmith_data:/appsmith-stacks
    environment:
{% if appsmith_encryption_password %}
      - APPSMITH_ENCRYPTION_PASSWORD={{ appsmith_encryption_password }}
{% endif %}
{% if appsmith_encryption_salt %}
      - APPSMITH_ENCRYPTION_SALT={{ appsmith_encryption_salt }}
{% endif %}
      - APPSMITH_DISABLE_TELEMETRY={{ appsmith_disable_telemetry | string | lower }}
{% if appsmith_disable_intercom %}
      - APPSMITH_DISABLE_INTERCOM=true
{% endif %}
{% if appsmith_supabase_enabled and appsmith_supabase_password %}
      # Supabase PostgreSQL connection
      - APPSMITH_DB_URL=postgresql://postgres:{{ appsmith_supabase_password }}@{{ appsmith_supabase_host }}:{{ appsmith_supabase_port }}/postgres
{% endif %}
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost/api/v1/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
    networks:
      - {{ appsmith_docker_network }}

volumes:
  appsmith_data:
    driver: local

networks:
  {{ appsmith_docker_network }}:
    external: true
